<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <title>Film Reel</title>
    <link rel="stylesheet" href="css/style.css">
  </head>

  <body>
    <div id="header">
    	<img src="images/icon.svg" alt="Film Reel Logo" id="header-logo" />
    	<a href="https://github.com/kirpal/filmreel" class="header-links"><img src="images/github.png" alt="Github"></a>
    	<a href="#downloads" class="header-links">Downloads</a>
    	<a href="#features" class="header-links">Features</a>
    </div>
    <div id="hero">
      <div id="hero-content">
        <h1 id="hero-title">Film Reel</h1>
        <h2 id="hero-description">Download or stream 1000's of movies with Film Reel. </h2>
        <a href="" id="hero-download">Download</a><br>
        <p class="hero-platforms" id="current-platform"></p><a href="#downloads" class="hero-platforms">More Platforms</a>
      </div>
    </div>
    <div id="features">
      <div id="hero-screenshot">
        <img src="images/screenshot.png" alt="Film Reel Screenshot">
      </div>
      <a name="features"></a>
      <h1>Features</h1>
      <div id="features-grouper">
        <div class="feature">
          <img src="images/download.svg" alt="Download Icon">
          <h2>Download or Stream</h2>
          <p>You can download movies to watch offline anytime you want, or you can stream them to watch instantly.</p>
        </div>
        <div class="feature">
          <img src="images/hourglass.svg" alt="Lightning Icon">
          <h2>Lightning Fast</h2>
          <p>Using peer-to-peer technology, the videos are loaded in pieces. This means that they load and play faster with no quality drop.</p>
        </div>
        <div class="feature">
          <img src="images/film.svg" alt="Movie Icon">
          <h2>Thousands of Movies</h2>
          <p>There are thousands of movies available to watch, with more being added each and every day.</p>
        </div>
        <div class="feature">
          <img src="images/heart.svg" alt="Infinity Icon">
          <h2>Free and Unlimited</h2>
          <p>There's no limit to the number of movies you can watch or download, all for free.</p>
        </div>
      <!--  <div class="feature">
          <img src="images/smartphone.svg" alt="Phone Icon">
          <h2>Remote App</h2>
          <p>Control playback and start downloads using the free mobile Film Reel app.</p>
        </div> -->
        <div class="feature">
          <img src="images/picture.svg" alt="HD Player Icon">
          <h2>HD Player</h2>
          <p>Use the player to watch any available movie at it's full HD resolution.</p>
        </div>
        <div class="feature">
          <img src="images/screen.svg" alt="Computer Icon">
          <h2>Cross Platform</h2>
          <p>The Film Reel app is compatible with MacOS, Windows, and Linux.</p>
        </div>
      </div>
    </div>
    <div id="downloads">
      <a name="downloads"></a>
      <h1>Downloads</h1>
      <div id="version-selector">
        <select id="version-selector-select">
        </select>
      </div>
      <br>
      <div class="platform">
        <img src="images/windows.png" alt="Windows Logo">
        <h2>Windows</h2>
        <h3>(Windows 7+)</h3>
        <a href="" name="Windows">Download</a>
      </div>
      <br>
      <div class="platform">
        <img src="images/mac.png" alt="Mac Logo">
        <h2>Mac</h2>
        <h3>(macOS 10.8+)</h3>
        <a href="" name="Mac">Download</a>
      </div>
      <br>
      <div class="platform">
        <img src="images/linux.png" alt="Linux Logo">
        <h2>Linux (.deb)</h2>
        <h3>(Ubuntu LTS 12.04+, Debian 8+)</h3>
        <a href="" name="Linux (.deb)">Download</a>
      </div>
      <br>
      <div class="platform">
        <img src="images/linux.png" alt="Linux Logo">
        <h2>Linux (Gzip)</h2>
        <h3>(Ubuntu LTS 12.04+, Debian 8+)</h3>
        <a href="" name="Linux (Gzip)">Download</a>
      </div>
    </div>
    <div id="footer">

    </div>
    <script src="https://cdn.rawgit.com/github/fetch/master/fetch.js"></script>
    <script>
      fetch("https://api.github.com/repos/Kirpal/filmreel/releases", {method: "GET"}).then(function (response){
        return response.json();
      })
      .then(function (body){
        var stable = body.filter(function(elm){return !elm.prerelease});

        function findAsset(platform, assetList){
          var platformIdentifiers = [];
          if(platform === "Windows"){
            platformIdentifiers = ["exe"];
          }else if(platform === "Mac"){
            platformIdentifiers = ["dmg"];
          }else if(platform === "Linux (.deb)"){
            platformIdentifiers = ["deb"];
          }else if(platform === "Linux (Gzip)"){
            platformIdentifiers = ["tar", "gz"];
          }
          var filteredAssets = assetList.filter(function(asset){
            var matches = 0;
            for(var i = 0; i < platformIdentifiers.length; i++){
              if(asset.name.includes(platformIdentifiers[i])){
                matches += 1;
              }
            }
            return matches === platformIdentifiers.length;
          })
          return filteredAssets;
        }

        var platformName = "Windows";
        if(navigator.platform.includes("Linux")){
          document.getElementById("current-platform").innerHTML = stable[0].tag_name + "&nbsp;&nbsp;-&nbsp;&nbsp;Linux (.deb)&nbsp;&nbsp;-&nbsp;";
          platformName = "Linux (.deb)";
        }else if(navigator.platform.includes("Mac")){
          document.getElementById("current-platform").innerHTML = stable[0].tag_name + "&nbsp;&nbsp;-&nbsp;&nbsp;MacOS&nbsp;&nbsp;-&nbsp;";
          platformName = "Mac";
        }else{
          document.getElementById("current-platform").innerHTML = stable[0].tag_name + "&nbsp;&nbsp;-&nbsp;&nbsp;Windows&nbsp;&nbsp;-&nbsp;";
        }

        var filteredAssets = findAsset(platformName, stable[0].assets);
        if(filteredAssets.length >= 1){
          document.getElementById("hero-download").href = filteredAssets[0].browser_download_url;
        }else{
          document.getElementById("hero-download").href = "#downloads";
          document.getElementById("current-platform").innerHTML = stable[0].tag_name + "&nbsp;&nbsp;-&nbsp;&nbsp;Platform Unavailable&nbsp;&nbsp;-&nbsp;";
        }

        var select = document.getElementById("version-selector-select")
        for(var i = 0; i < stable.length; i++){
          var option = document.createElement("option");
          option.text = stable[i].tag_name;
          option.value = i;
          select.add(option)
        }
        function updateLinks(version){
          var versionAssets = stable[version].assets;
          var downloads = document.getElementsByClassName("platform");
          for(var i = 0; i < downloads.length; i++){
            for(var j = 0; j < downloads[i].children.length; j++){
              if(downloads[i].children[j].nodeName === "A"){
                var filteredAssets = findAsset(downloads[i].children[j].name, versionAssets);
                if(filteredAssets.length >= 1){
                  downloads[i].style.display = "inline-block";
                  downloads[i].children[j].href = filteredAssets[0].browser_download_url;
                }else{
                  downloads[i].style.display = "none";
                }
              }
            }
          }
        }
        updateLinks(select.value);
        select.addEventListener("input", function(){
          updateLinks(this.value);
        })
      });
    </script>
  </body>
</html>
